<div *ngIf="!loading && appointment; else loadingOrError">
  <!-- Botón de volver usando plantilla -->
  <mat-card class="cardWithShadow m-b-16">
    <mat-card-content class="p-16">
      <button mat-button (click)="goBack()" class="d-flex align-items-center">
        <i-tabler name="arrow-left" class="icon-20 m-r-8"></i-tabler>
        Volver
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Card principal del detail -->
  <mat-card class="cardWithShadow">
    <mat-card-content class="p-24">
      <div class="row">
        <!-- Columna izquierda: Foto y nombre del asesor -->
        <div class="col-md-4 text-center m-b-24">
          <img 
            [src]="appointment.advisorPhoto || 'assets/images/profile/user-1.jpg'" 
            class="rounded-circle border p-5" 
            width="120"
            alt="Foto del asesor" 
          />
          <h3 class="m-t-16 m-b-0">{{ appointment.advisorName }}</h3>
        </div>

        <!-- Columna derecha: Información de la cita -->
        <div class="col-md-8">
          <!-- Fecha programada -->
          <div class="m-b-20">
            <h5 class="text-muted f-s-14 m-b-8">Fecha programada</h5>
            <p class="m-b-0 f-s-16">
              {{ formattedDate }}{{ formattedTime ? ', ' + formattedTime : '' }}
            </p>
          </div>

          <!-- Link de videoconferencia -->
          <div class="m-b-20">
            <h5 class="text-muted f-s-14 m-b-8">Link de la videoconferencia</h5>
            <a [href]="appointment.meetingUrl" target="_blank" class="text-primary f-s-16">
              {{ appointment.meetingUrl }}
            </a>
          </div>

          <!-- Comentario -->
          <div class="m-b-24">
            <h5 class="text-muted f-s-14 m-b-8">Comentario brindado por ti</h5>
            <p class="m-b-0 f-s-16">
              {{ appointment.message }}
            </p>
          </div>

          <!-- Botones de acción -->
          <div class="d-flex gap-12">
            <button mat-flat-button color="warn" (click)="openCancelModal()">
              <i-tabler name="x" class="icon-18 m-r-8"></i-tabler>
              Cancelar Cita
            </button>
          </div>

          <!-- Mensaje de error -->
          <div class="alert alert-danger m-t-16" *ngIf="errorMessage">
            {{ errorMessage }}
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<ng-template #loadingOrError>
  <mat-card class="cardWithShadow" *ngIf="loading">
    <mat-card-content class="text-center p-y-32">
      <mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
      <div class="m-t-16">Cargando...</div>
    </mat-card-content>
  </mat-card>
  
  <mat-card class="cardWithShadow" *ngIf="error">
    <mat-card-content class="text-center p-y-32">
      <i-tabler name="alert-triangle" class="icon-48 text-warning m-b-16"></i-tabler>
      <div class="f-s-16 text-dark">No se pudo cargar la cita.</div>
    </mat-card-content>
  </mat-card>
</ng-template>
