<div class="appointment-detail-container" *ngIf="!loading && appointment; else loadingOrError">
  <div class="header-row">
    <button class="back-btn" (click)="goBack()" aria-label="Volver">
      <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="14" cy="14" r="14" fill="#fff" stroke="#e6eaf0" stroke-width="2"/>
        <path d="M9 9L19 19M19 9L9 19" stroke="#223153" stroke-width="2.2" stroke-linecap="round"/>
      </svg>
      <span class="back-text">Volver</span>
    </button>
  </div>
  <div class="detail-content">
    <div class="advisor-section">
      <div class="avatar-wrapper">
        <img [src]="appointment?.advisorPhoto || 'assets/images/profile/default-avatar.png'" class="advisor-photo" alt="Foto asesor" />
      </div>
      <div class="advisor-name">{{ appointment?.advisorName || 'Asesor' }}</div>
    </div>
    <div class="info-section">
      <div class="info-group">
        <label>Fecha programada</label>
        <input type="text" [value]="appointment?.scheduledDate ? (appointment.scheduledDate | date: 'd \'de\' MMMM \'de\' y' : undefined : 'es') : 'Sin fecha'"
          readonly />
        <input type="text" [value]="appointment?.startTime && appointment?.endTime ? (appointment.startTime + ' - ' + appointment.endTime) : 'Sin hora'" readonly />
      </div>
      <div class="info-group">
        <label>Link de la videoconferencia</label>
        <input type="text" [value]="appointment?.meetingUrl" readonly />
      </div>
      <div class="info-group">
        <label>Comentario brindado por ti</label>
        <textarea readonly>{{ appointment?.message }}</textarea>
      </div>
      <button class="cancel-btn" (click)="openCancelModal()">Cancelar Cita</button>
    </div>
  </div>

  <!-- Modal de cancelación -->
  <div class="cancel-modal" *ngIf="showCancelModal">
    <div class="modal-content">
      <button class="close-btn" (click)="closeCancelModal()" aria-label="Cerrar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="12" fill="#f7f7f7"/><path d="M7 7L17 17M17 7L7 17" stroke="#223153" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
      <h3>¿Seguro que deseas cancelar tu cita?</h3>
      <p>Por favor, ingresa el motivo por el cual cancelarás la cita</p>
      <textarea class="modal-textarea" [(ngModel)]="cancelReason" placeholder="Ingresa tu mensaje..." [disabled]="cancelLoading"></textarea>
      <div class="error" *ngIf="cancelError">{{ cancelError }}</div>
      <button class="cancel-btn" (click)="confirmCancel()" [disabled]="cancelLoading">
        {{ cancelLoading ? 'Cancelando...' : 'Cancelar Cita' }}
      </button>
    </div>
  </div>
</div>
<ng-template #loadingOrError>
  <div class="loading-error" *ngIf="loading">Cargando...</div>
  <div class="loading-error" *ngIf="error">No se pudo cargar la cita.</div>
</ng-template>
